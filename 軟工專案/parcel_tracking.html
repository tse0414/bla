<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>步驟二：包裹服務與追蹤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    body { margin: 0; background: #f5f7fb; color: #222; }
    header {
      background: linear-gradient(120deg, #1f4f96, #2c7adf);
      color: #fff; padding: 16px 32px;
      display: flex; align-items: center; justify-content: space-between;
    }
    header h1 { margin: 0; font-size: 20px; }
    header small { font-size: 12px; opacity: .8; }
    nav {
      display: flex; gap: 8px; padding: 8px 32px;
      background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,.08);
    }
    nav a {
      text-decoration: none; padding: 6px 12px; border-radius: 999px;
      font-size: 13px; color: #333; background: #eef2f8;
    }
    nav a:hover { background: #d9e4ff; }
    main {
      padding: 16px 32px 40px; max-width: 1100px; margin: 0 auto;
    }
    .section { margin-top: 24px; }
    .section h2 { font-size: 18px; color: #1f4f96; margin-bottom: 4px; }
    .section small { font-size: 12px; color: #6b7280; }
    .card {
      background: #fff; border-radius: 12px; padding: 16px 20px;
      margin-top: 12px; box-shadow: 0 2px 5px rgba(15,23,42,.08);
    }
    .card h3 { margin-top: 0; margin-bottom: 8px; font-size: 16px; color: #111827; }
    .muted { color: #6b7280; font-size: 12px; }
    form {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
      gap: 12px 16px; margin-top: 10px; font-size: 13px;
    }
    label { display: flex; flex-direction: column; font-size: 13px; color: #111827; }
    input, select, textarea {
      margin-top: 4px; padding: 6px 8px; border-radius: 8px;
      border: 1px solid #d1d5db; font-size: 13px; resize: vertical;
    }
    textarea { min-height: 60px; }
    .full-width { grid-column: 1 / -1; }
    .btn-row {
      grid-column: 1 / -1; display: flex; gap: 8px;
      margin-top: 4px; flex-wrap: wrap;
    }
    button {
      border: none; border-radius: 999px; padding: 6px 14px;
      font-size: 13px; cursor: pointer;
    }
    .btn-primary { background: #2563eb; color: #fff; }
    .btn-outline { background: #fff; color: #2563eb; border: 1px solid #2563eb; }
    table {
      width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px;
    }
    th, td {
      border: 1px solid #e5e7eb; padding: 6px 8px; text-align: left; white-space: nowrap;
    }
    th { background: #f3f4f6; }
    .pill {
      display: inline-block; padding: 2px 8px; font-size: 11px;
      background: #e5e7eb; border-radius: 999px; margin-right: 4px; margin-bottom: 4px;
    }
    @media (max-width: 640px) {
      header, nav, main { padding-left: 16px; padding-right: 16px; }
    }
  </style>
</head>
<body>
<header>
  <h1>包裹追蹤與計費系統 - 步驟二</h1>
  <div>
    <small style="margin-right:8px;">包裹服務分類與收件準備 / 追蹤與物流</small>
    <label style="font-size:12px;">
      目前角色：
      <select id="roleSelect" onchange="onRoleChange()" style="padding:4px 8px;border-radius:999px;border:none;">
        <option value="client">客戶</option>
        <option value="staff">作業人員</option>
        <option value="admin">管理員 / 系統管理員</option>
      </select>
    </label>
  </div>
</header>


<nav>
  <a href="customer.html">步驟一：客戶資料</a>
  <a href="parcel_tracking.html">步驟二：包裹與追蹤</a>
  <a href="billing.html">步驟三：計費與帳單</a>
</nav>

<main>
  <!-- 客戶摘要 -->
  <section class="section">
    <h2>確認客戶基本資料</h2>
    <small>資料來自步驟一，如有誤可返回上一頁修改。</small>
    <div class="card">
      <div id="customerSummary" class="muted">正在讀取客戶資料…</div>
      <p style="margin-top:8px;">
        <a href="customer.html" style="font-size:13px;">⬅ 返回步驟一重新編輯客戶資料</a>
      </p>
    </div>
  </section>

  <!-- 包裹服務分類與收件準備 -->
  <section class="section">
    <h2>包裹服務分類與收件準備</h2>
    <small>建立包裹、設定服務類型與特殊標示。</small>

    <div class="card">
      <h3>建立包裹</h3>
      <form>
        <label>
          追蹤編號
          <div style="display:flex; gap:6px;">
            <input id="trackingInput" type="text" placeholder="按『產生』自動生成" />
            <button type="button" class="btn-outline" onclick="generateTrackingId()">產生</button>
          </div>
        </label>

        <label>
          寄件客戶帳號
          <input id="senderAccount" type="text" placeholder="會自動帶入或自行填寫" />
        </label>

        <label>
          收件人姓名
          <input type="text" placeholder="收件人姓名" />
        </label>

        <label>
          收件人電話
          <input type="tel" placeholder="收件人電話" />
        </label>

        <label class="full-width">
          收件地址
          <input type="text" placeholder="收件地址" />
        </label>

        <label>
          包裹類型
          <select>
            <option>平郵信封</option>
            <option>小型箱</option>
            <option>中型箱</option>
            <option>大型箱</option>
          </select>
        </label>

        <label>
          重量（kg）
          <input type="number" step="0.01" placeholder="例如：1.5" />
        </label>

        <label>
          尺寸（長×寬×高，cm）
          <input type="text" placeholder="例如：30 x 20 x 15" />
        </label>

        <label>
          配送時效
          <select>
            <option>隔夜達</option>
            <option>兩日達</option>
            <option>標準速遞</option>
            <option>經濟速遞</option>
          </select>
        </label>

        <label>
          申報價值（元）
          <input type="number" step="1" placeholder="例如：3000" />
        </label>

        <label class="full-width">
          內容物描述（若需）
          <textarea placeholder="例如：書籍、衣物、電子產品…"></textarea>
        </label>

        <label class="full-width">
          特殊服務標示
          <div>
            <label style="display:inline-flex;align-items:center;margin-right:12px;">
              <input type="checkbox" /> 危險物品
            </label>
            <label style="display:inline-flex;align-items:center;margin-right:12px;">
              <input type="checkbox" /> 易碎品
            </label>
            <label style="display:inline-flex;align-items:center;">
              <input type="checkbox" /> 國際貨件要求
            </label>
          </div>
        </label>

        <div class="btn-row">
            <button type="button" class="btn-primary" onclick="savePackage()">送出包裹資料（示意）</button>
            <button type="reset" class="btn-outline">清除表單</button>
        </div>

      </form>
    </div>
  </section>

  <!-- 追蹤與物流 -->
  <section class="section">
    <h2>追蹤與物流</h2>
    <small>查詢貨態、顯示事件歷程，示意需求 1.4。</small>

    <div class="card">
      <h3>包裹查詢介面（示意）</h3>
      <form>
        <label class="full-width">
          追蹤編號
          <input type="text" placeholder="輸入追蹤編號，例如：TRK-20251128-001" />
        </label>

        <label>
          客戶帳號
          <input type="text" placeholder="CUST-0001" />
        </label>

        <label>
          運送日期（起）
          <input type="date" />
        </label>

        <label>
          運送日期（迄）
          <input type="date" />
        </label>

        <label>
          運輸載具識別碼（貨車）
          <input type="text" placeholder="例如：TRUCK-08" />
        </label>

        <label>
          倉儲地點代碼
          <input type="text" placeholder="例如：WH-TPE-01" />
        </label>

        <label class="full-width">
          異常狀態
          <select>
            <option>全部</option>
            <option>遺失</option>
            <option>延誤</option>
            <option>損毀</option>
          </select>
        </label>

        <div class="btn-row">
          <button type="button" class="btn-primary">查詢包裹狀態（示意）</button>
          <button type="reset" class="btn-outline">清除條件</button>
        </div>
      </form>
    </div>

    <div class="card">
      <h3>包裹當前狀態與歷史事件（示意）</h3>
      <p>
        <span class="pill">追蹤編號：TRK-20251128-001</span>
        <span class="pill">目前狀態：配送中</span>
        <span class="pill">異常：無</span>
      </p>

      <table>
        <thead>
        <tr>
          <th>事件時間戳記</th>
          <th>事件類型</th>
          <th>地點 / 倉儲</th>
          <th>說明</th>
          <th>操作人 / 載具</th>
        </tr>
        </thead>
        <tbody id="trackingEventsBody">
        <tr>
          <td>2025-11-27 09:12</td>
          <td>起運地收件</td>
          <td>台北市信義區門市</td>
          <td>收件完成，等待撿貨</td>
          <td>門市人員 A01</td>
        </tr>
        <tr>
          <td>2025-11-27 14:30</td>
          <td>進入貨車</td>
          <td>WH-TPE-01</td>
          <td>裝車完成，準備前往中轉站</td>
          <td>TRUCK-08</td>
        </tr>
        <tr>
          <td>2025-11-28 08:05</td>
          <td>配送中</td>
          <td>新北市中和區</td>
          <td>配送中，預計今日送達</td>
          <td>駕駛 B09</td>
        </tr>
        </tbody>
      </table>

      <div style="margin-top:10px;">
        <strong style="font-size:13px;">新增事件（前端示意）</strong>
        <form style="margin-top:8px;">
          <label>
            事件時間
            <input type="datetime-local" id="eventTime" />
          </label>
          <label>
            事件類型
            <select id="eventType">
              <option>起運地收件</option>
              <option>進入貨車</option>
              <option>離開貨車</option>
              <option>進入倉儲</option>
              <option>分揀</option>
              <option>轉運</option>
              <option>配送中</option>
              <option>最終投遞</option>
              <option>簽收完成</option>
              <option>延誤</option>
              <option>遺失</option>
              <option>損毀</option>
            </select>
          </label>
          <label>
            地點 / 倉儲代碼
            <input type="text" id="eventLocation" placeholder="例如：WH-KHH-02" />
          </label>
          <label class="full-width">
            說明
            <input type="text" id="eventNote" placeholder="簡要說明此事件…" />
          </label>
          <div class="btn-row">
            <button type="button" class="btn-outline" onclick="addTrackingEvent()">加入事件（示意）</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- 下一步按鈕 -->
  <section class="section">
    <div class="card">
      <div class="btn-row">
        <button class="btn-outline" type="button" onclick="window.location.href='customer.html'">⬅ 上一步：客戶資料</button>
        <button class="btn-primary" type="button" onclick="window.location.href='billing.html'">下一步：計費與帳單 ➜</button>
      </div>
    </div>
  </section>
</main>

<script>
  // ========== 載入客戶資料 ==========
  function loadCustomer() {
    const raw = localStorage.getItem('currentCustomer');
    const container = document.getElementById('customerSummary');

    if (!raw) {
      container.innerHTML = '<span style="color:red;">找不到客戶資料，請先回到步驟一填寫。</span>';
      return;
    }

    try {
      const c = JSON.parse(raw);
      container.innerHTML = `
        <div><span class="pill">客戶姓名：</span> ${c.name}</div>
        <div><span class="pill">客戶帳號：</span> ${c.id}</div>
        <div><span class="pill">聯絡電話：</span> ${c.phone}</div>
        <div><span class="pill">電子郵件：</span> ${c.email}</div>
        <div><span class="pill">地址：</span> ${c.address}</div>
        <div><span class="pill">客戶類型：</span> ${c.type}</div>
        <div><span class="pill">帳單偏好：</span> ${c.billingPref}</div>
      `;
    } catch (e) {
      container.innerHTML = '客戶資料格式讀取失敗。';
    }
  }

  // ========== 函式：產生追蹤編號 ==========
  function generateTrackingId() {
    const now = new Date();
    const y = now.getFullYear();
    const m = String(now.getMonth() + 1).padStart(2, "0");
    const d = String(now.getDate()).padStart(2, "0");
    const rand = Math.floor(Math.random() * 900 + 100); // 3 位數亂碼

    const id = `TRK-${y}${m}${d}-${rand}`;
    document.getElementById("trackingInput").value = id;
  }

  // ========== 儲存包裹資料 ==========
  function savePackage() {
    const pkg = {
      trackingId: document.getElementById("trackingInput").value,
      senderAccount: document.getElementById("senderAccount").value,
      receiverName: document.getElementById("receiverName").value,
      receiverPhone: document.getElementById("receiverPhone").value,
      receiverAddr: document.getElementById("receiverAddr").value,
      pkgType: document.getElementById("pkgType").value,
      weight: document.getElementById("weight").value,
      size: document.getElementById("size").value,
      deliveryType: document.getElementById("deliveryType").value,
      declaredValue: document.getElementById("declaredValue").value,
      desc: document.getElementById("desc").value,
      specialFlags: {
        dangerous: document.getElementById("flagDangerous").checked,
        fragile: document.getElementById("flagFragile").checked,
        intl: document.getElementById("flagIntl").checked
      }
    };

    // 取出現有資料
    const stored = JSON.parse(localStorage.getItem("packages") || "[]");
    stored.push(pkg);

    // 存回 localStorage
    localStorage.setItem("packages", JSON.stringify(stored));

    alert("包裹已儲存！");
  }

  // ========== 新增追蹤事件 ==========
  function addTrackingEvent() {
    const time = document.getElementById("eventTime").value;
    const type = document.getElementById("eventType").value;
    const loc = document.getElementById("eventLocation").value;
    const note = document.getElementById("eventNote").value;

    if (!time || !type) {
      alert("請輸入事件時間與類型！");
      return;
    }

    const tableBody = document.getElementById("trackingEventsBody");

    // 新增到畫面上
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${time}</td>
      <td>${type}</td>
      <td>${loc}</td>
      <td>${note}</td>
    `;
    tableBody.appendChild(tr);

    // 同時寫入 localStorage
    const events = JSON.parse(localStorage.getItem("trackingEvents") || "[]");
    events.push({
      time, type, location: loc, note
    });
    localStorage.setItem("trackingEvents", JSON.stringify(events));

    // 清空輸入欄位
    document.getElementById("eventTime").value = "";
    document.getElementById("eventLocation").value = "";
    document.getElementById("eventNote").value = "";
  }

  // ============================================================
  //  ⭐⭐ 角色管理（新加入）⭐⭐
  // ============================================================

  // 初始化角色（讓三頁同步）
  function initRole() {
    const sel = document.getElementById("roleSelect");
    if (!sel) return;

    const saved = localStorage.getItem("currentRole") || "client";
    sel.value = saved;
  }

  // 切換角色 → 寫回 localStorage
  function onRoleChange() {
    const sel = document.getElementById("roleSelect");
    if (!sel) return;
    localStorage.setItem("currentRole", sel.value);
  }

  // ============================================================
  // ⭐頁面載入時執行
  // ============================================================

  initRole();      // ← 角色同步
  loadCustomer();  // ← 顯示客戶基本資料
</script>


</body>
</html>
